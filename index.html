<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SRT to LRC Converter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
            },
          },
        },
      }
    </script>
    <!-- Babel for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Import Map for React and Lucide -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
    <style>
      /* Custom scrollbar for dark theme */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #475569;
      }
    </style>
  </head>
  <body class="bg-slate-950 text-slate-200">
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel" data-type="module" data-presets="react,typescript">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        ArrowRight, 
        Upload, 
        Download, 
        Copy, 
        Check, 
        Trash2, 
        FileText, 
        Music, 
        Save,
        AlignLeft,
        Sparkles,
        FileCode
      } from 'lucide-react';

      // --- Utils: Parser Logic ---
      /**
       * Converts SRT formatted string to LRC formatted string.
       */
      const convertSrtToLrc = (srtContent) => {
        if (!srtContent) return '';

        // Normalize line endings to \n
        const normalized = srtContent.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
        
        // Split by double newlines to isolate blocks
        const blocks = normalized.split(/\n\n+/);

        const lrcLines = blocks.map((block) => {
          const lines = block.split('\n').map(line => line.trim()).filter(line => line !== '');
          
          const timeLineIndex = lines.findIndex(l => l.includes('-->'));

          if (timeLineIndex === -1) {
            return null;
          }

          const timeLine = lines[timeLineIndex];
          const textLines = lines.slice(timeLineIndex + 1);
          
          if (textLines.length === 0) {
             return null;
          }

          const timeMatch = timeLine.match(/(\d{1,2}):(\d{2}):(\d{2})[,.](\d{3})/);
          
          if (!timeMatch) {
            return null;
          }

          const [_, hh, mm, ss, ms] = timeMatch;

          const hours = parseInt(hh, 10);
          const minutes = parseInt(mm, 10);
          const totalMinutes = hours * 60 + minutes;

          const formattedMinutes = String(totalMinutes).padStart(2, '0');
          const textContent = textLines.join(' ');

          return `[${formattedMinutes}:${ss}.${ms}]${textContent}`;
        }).filter(line => line !== null);

        return lrcLines.join('\n');
      };

      // --- Component: Converter ---
      const Converter = () => {
        const [input, setInput] = useState('');
        const [output, setOutput] = useState('');
        const [copied, setCopied] = useState(false);
        
        // Download configuration state
        const [baseName, setBaseName] = useState('lyrics');
        const [extension, setExtension] = useState('txt');
        
        const fileInputRef = useRef(null);

        // Auto convert when input changes
        useEffect(() => {
          const result = convertSrtToLrc(input);
          setOutput(result);
        }, [input]);

        const handleFileUpload = (event) => {
          const file = event.target.files?.[0];
          if (!file) return;

          const nameWithoutExt = file.name.replace(/\.[^/.]+$/, "");
          setBaseName(nameWithoutExt);

          const reader = new FileReader();
          reader.onload = (e) => {
            const content = e.target?.result;
            setInput(content);
          };
          reader.readAsText(file);
        };

        const handleDrop = (event) => {
          event.preventDefault();
          const file = event.dataTransfer.files?.[0];
          if (file) {
            const nameWithoutExt = file.name.replace(/\.[^/.]+$/, "");
            setBaseName(nameWithoutExt);
            
            const reader = new FileReader();
            reader.onload = (e) => {
              const content = e.target?.result;
              setInput(content);
            };
            reader.readAsText(file);
          }
        };

        const handleDragOver = (event) => {
          event.preventDefault();
        };

        const copyToClipboard = async () => {
          try {
            await navigator.clipboard.writeText(output);
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          } catch (err) {
            console.error('Failed to copy text: ', err);
          }
        };

        const downloadFile = () => {
          let finalName = baseName.trim();
          if (!finalName) {
            finalName = prompt("Please enter a filename:", "lyrics") || "lyrics";
            setBaseName(finalName);
          }

          const element = document.createElement("a");
          const file = new Blob([output], {type: 'text/plain'});
          element.href = URL.createObjectURL(file);
          element.download = `${finalName}.${extension}`;
          document.body.appendChild(element);
          element.click();
          document.body.removeChild(element);
        };

        const downloadPureLyrics = () => {
            if (!output) return;

            // Remove timestamps [mm:ss.xxx] from the beginning of lines
            const pureLyrics = output.replace(/^\[\d{2}:\d{2}\.\d{2,3}\]/gm, '');

            let finalName = baseName.trim();
            if (!finalName) {
              finalName = prompt("Please enter a filename:", "lyrics") || "lyrics";
              setBaseName(finalName);
            }

            const element = document.createElement("a");
            const file = new Blob([pureLyrics], {type: 'text/plain'});
            element.href = URL.createObjectURL(file);
            // Force .txt for pure lyrics
            element.download = `${finalName}_pure.txt`;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        };

        const clearAll = () => {
          setInput('');
          setBaseName('lyrics');
          if (fileInputRef.current) {
            fileInputRef.current.value = '';
          }
        };

        return (
          <div className="space-y-6">
            {/* Controls Bar */}
            <div className="bg-slate-900/50 backdrop-blur-xl border border-white/5 rounded-2xl p-4 shadow-2xl flex flex-col md:flex-row gap-4 items-center justify-between">
              {/* Left Side: Actions */}
              <div className="flex items-center gap-3 w-full md:w-auto">
                <input
                  type="file"
                  accept=".srt,.txt"
                  onChange={handleFileUpload}
                  className="hidden"
                  ref={fileInputRef}
                />
                <button
                  onClick={() => fileInputRef.current?.click()}
                  className="flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-xl transition-all font-medium text-sm border border-white/5 hover:border-white/10 active:scale-95"
                >
                  <Upload className="w-4 h-4 text-indigo-400" />
                  Upload SRT
                </button>
                
                <button
                  onClick={clearAll}
                  disabled={!input}
                  className={`flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl transition-all font-medium text-sm border border-transparent ${
                    !input 
                      ? 'text-slate-600 bg-transparent cursor-not-allowed' 
                      : 'text-red-400 hover:bg-red-500/10 hover:border-red-500/20 active:scale-95'
                  }`}
                >
                  <Trash2 className="w-4 h-4" />
                  Clear
                </button>
              </div>

              {/* Right Side: Download Settings */}
              <div className="flex flex-col xl:flex-row items-center gap-3 w-full md:w-auto">
                <div className="flex items-center gap-2 w-full xl:w-auto bg-slate-950/50 border border-white/5 rounded-xl p-1.5 focus-within:ring-2 focus-within:ring-indigo-500/20 transition-all">
                   <div className="relative flex-grow">
                     <input 
                        type="text" 
                        value={baseName}
                        onChange={(e) => setBaseName(e.target.value)}
                        placeholder="Filename"
                        className="w-full sm:w-40 bg-transparent border-none text-sm px-3 py-1.5 focus:outline-none text-slate-200 placeholder-slate-600"
                     />
                     <span className="absolute right-0 top-1/2 -translate-y-1/2 w-px h-4 bg-white/10"></span>
                   </div>
                   <select 
                      value={extension}
                      onChange={(e) => setExtension(e.target.value)}
                      className="bg-transparent border-none text-sm px-2 py-1.5 font-medium text-slate-400 focus:outline-none cursor-pointer hover:text-indigo-400"
                   >
                      <option value="txt" className="bg-slate-900">.txt</option>
                      <option value="lrc" className="bg-slate-900">.lrc</option>
                   </select>
                </div>

                <div className="flex items-center gap-2 w-full xl:w-auto">
                    <button
                    onClick={downloadPureLyrics}
                    disabled={!output}
                    className="flex-1 xl:flex-none flex items-center justify-center gap-2 px-4 py-2.5 bg-slate-800 border border-white/5 hover:bg-slate-700 text-slate-300 rounded-xl transition-all font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 whitespace-nowrap"
                    title="Download lyrics without timestamps"
                    >
                    <AlignLeft className="w-4 h-4" />
                    No Time
                    </button>

                    <button
                    onClick={downloadFile}
                    disabled={!output}
                    className="flex-1 xl:flex-none flex items-center justify-center gap-2 px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-xl transition-all font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/40 active:scale-95 border border-white/10"
                    >
                    <Download className="w-4 h-4" />
                    Download
                    </button>
                </div>
              </div>
            </div>

            {/* Editor Area */}
            <div className="flex flex-col md:flex-row gap-6 h-[calc(100vh-280px)] min-h-[500px]">
              {/* Input Column */}
              <div className="flex-1 flex flex-col h-full">
                <div className="flex items-center justify-between mb-3 px-1">
                   <label className="text-sm font-semibold text-slate-300 flex items-center gap-2">
                     <FileCode className="w-4 h-4 text-indigo-400" />
                     Input (SRT Format)
                   </label>
                   <span className="text-xs text-slate-500 bg-white/5 px-2 py-1 rounded-md border border-white/5">Drag & Drop</span>
                </div>
                <div 
                  className="relative flex-grow group"
                  onDrop={handleDrop}
                  onDragOver={handleDragOver}
                >
                  <div className="absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 rounded-2xl pointer-events-none"></div>
                  <textarea
                    className="w-full h-full p-5 rounded-2xl border border-white/10 bg-slate-900/50 backdrop-blur-sm font-mono text-sm leading-relaxed text-slate-300 focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 outline-none resize-none transition-all shadow-inner group-hover:border-white/20 placeholder-slate-600"
                    placeholder={`Paste SRT content here...\n\nExample:\n1\n00:00:12,000 --> 00:00:17,766\nLyrics text here`}
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    spellCheck={false}
                  />
                  {input === '' && (
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                      <div className="flex flex-col items-center gap-4 text-slate-600 group-hover:text-slate-500 transition-colors">
                        <div className="p-4 rounded-full bg-white/5 border border-white/5 shadow-xl">
                          <Upload className="w-8 h-8 opacity-50" />
                        </div>
                        <span className="font-medium">Drop SRT file here</span>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* Arrow (Visible on desktop/tablet) */}
              <div className="hidden md:flex flex-col justify-center items-center text-slate-700">
                 <ArrowRight className="w-6 h-6 opacity-20" />
              </div>

              {/* Output Column */}
              <div className="flex-1 flex flex-col h-full">
                <div className="flex items-center justify-between mb-3 px-1">
                   <label className="text-sm font-semibold text-slate-300 flex items-center gap-2">
                     <Music className="w-4 h-4 text-purple-400" />
                     Output (LRC / TXT)
                   </label>
                   <button
                      onClick={copyToClipboard}
                      disabled={!output}
                      className={`flex items-center gap-1.5 px-3 py-1 rounded-lg text-xs font-medium transition-all border ${
                        copied 
                          ? 'bg-green-500/10 text-green-400 border-green-500/20' 
                          : 'bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 border-indigo-500/20'
                      } disabled:opacity-0`}
                    >
                      {copied ? <Check className="w-3 h-3" /> : <Copy className="w-3 h-3" />}
                      {copied ? 'Copied!' : 'Copy'}
                    </button>
                </div>
                <div className="relative flex-grow">
                  <div className="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-indigo-500/5 rounded-2xl pointer-events-none"></div>
                  <textarea
                    className="w-full h-full p-5 rounded-2xl border border-white/10 bg-slate-900/50 backdrop-blur-sm font-mono text-sm leading-relaxed text-slate-300 focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 outline-none resize-none transition-all shadow-inner placeholder-slate-600"
                    placeholder="Converted lyrics will appear here. You can also edit them manually."
                    value={output}
                    onChange={(e) => setOutput(e.target.value)}
                    spellCheck={false}
                  />
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- Component: App ---
      const App = () => {
        return (
          <div className="min-h-screen flex flex-col bg-slate-950 text-slate-200 selection:bg-indigo-500/30 font-sans">
            {/* Background Gradients */}
            <div className="fixed inset-0 z-0 overflow-hidden pointer-events-none">
              <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-indigo-900/20 blur-[120px]"></div>
              <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-purple-900/20 blur-[120px]"></div>
            </div>

            {/* Header */}
            <header className="sticky top-0 z-50 border-b border-white/5 bg-slate-950/80 backdrop-blur-xl supports-[backdrop-filter]:bg-slate-950/60">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div className="flex items-center space-x-3 group cursor-default">
                  <div className="relative">
                    <div className="absolute inset-0 bg-indigo-500 blur-md opacity-25 group-hover:opacity-50 transition-opacity"></div>
                    <div className="relative bg-gradient-to-br from-indigo-500 to-purple-600 p-2 rounded-xl shadow-lg shadow-indigo-500/20">
                      <Music className="w-6 h-6 text-white" />
                    </div>
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                      SRT to LRC
                      <span className="px-2 py-0.5 rounded-full bg-white/5 border border-white/5 text-[10px] font-mono text-indigo-300 font-medium uppercase tracking-wider">
                        Converter
                      </span>
                    </h1>
                  </div>
                </div>
                <div className="hidden sm:flex items-center gap-2 text-sm text-slate-400 bg-white/5 px-3 py-1.5 rounded-full border border-white/5">
                  <Sparkles className="w-3 h-3 text-indigo-400" />
                  <span>Pro Audio Tools</span>
                </div>
              </div>
            </header>

            {/* Main Content */}
            <main className="relative z-10 flex-grow py-8 px-4 sm:px-6 lg:px-8">
              <div className="max-w-7xl mx-auto">
                <Converter />
              </div>
            </main>

            {/* Footer */}
            <footer className="relative z-10 border-t border-white/5 py-8 mt-auto bg-slate-950/50 backdrop-blur-sm">
              <div className="max-w-7xl mx-auto px-4 text-center">
                <p className="text-slate-500 text-sm">
                  © {new Date().getFullYear()} Khee. Crafted with <span className="text-red-500">♥</span> for AI music lovers.
                </p>
              </div>
            </footer>
          </div>
        );
      };

      // --- Main Render ---
      const rootElement = document.getElementById('root');
      if (rootElement) {
        const root = createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
      }
    </script>
  </body>
</html>